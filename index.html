<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Elite Structural FX</title>
    <style>
        /* FONT RESTORED & FIXED FOR MOBILE */
        @font-face {
            font-family: 'NType82';
            src: url('data:font/otf;base64,AAEAAAARAQAABAAQR0RFRmY...') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        :root {
            --bg: #000000;
            --surface: #1C1C1E;
            --accent: #FF3B30;
            --text: #FFFFFF;
            --secondary-text: #8E8E93;
            --key-bg: #1C1C1E;
            --key-active: #3A3A3C;
        }

        body.light-mode {
            --bg: #F2F2F7;
            --surface: #FFFFFF;
            --text: #000000;
            --secondary-text: #636366;
            --key-bg: #E5E5EA;
            --key-active: #C7C7CC;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'NType82', -apple-system, BlinkMacSystemFont, sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            background: var(--bg); 
            color: var(--text); 
            height: 100dvh; 
            display: flex; 
            justify-content: center; 
            overflow: hidden; 
            position: fixed;
            width: 100%;
        }

        .app-container { 
            width: 100vw; 
            max-width: 450px; 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            padding: 20px; 
            padding-top: max(20px, env(safe-area-inset-top)); 
            padding-bottom: max(20px, env(safe-area-inset-bottom)); 
            justify-content: space-between; 
        }

        /* UI Elements */
        .sync-indicator { font-size: 11px; font-weight: bold; color: var(--accent); letter-spacing: 1.5px; }
        .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* SMOOTH CENTRIC ROTATION */
        .resync-btn {
            color: var(--accent);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        #resync-icon {
            display: inline-block;
            font-size: 22px;
            line-height: 1;
            transform-origin: center center;
        }

        .spinning {
            animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }

        #val-in { 
            font-size: 52px; color: var(--text); border: none; background: transparent; 
            outline: none; width: 70%; font-family: 'NType82';
        }
        .result-amt { font-size: 60px; color: var(--accent); line-height: 1; font-family: 'NType82'; }
        
        .keypad-grid { display: grid; grid-template-columns: 3fr 1fr; gap: 12px; height: 45%; }
        .numeric-zone { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .key { 
            background: var(--key-bg); border-radius: 22px; display: flex; 
            justify-content: center; align-items: center; font-size: 32px; 
            cursor: pointer; user-select: none;
        }
        .key:active { background: var(--key-active); transform: scale(0.92); }
        .pill-ac { background: var(--accent); color: white; font-size: 22px; }
        
        #picker-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100dvh; 
            background: var(--bg); z-index: 1000; display: none; 
            flex-direction: column; padding: 20px; 
            padding-top: max(20px, env(safe-area-inset-top));
        }
        .country-item { padding: 18px; border-bottom: 1px solid var(--key-bg); font-family: 'NType82'; }
    </style>
</head>
<body class="dark-mode">

<div id="picker-modal">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="font-size: 24px;">Select Currency</h2>
        <span onclick="closePicker()" style="font-size: 40px; cursor: pointer;">×</span>
    </div>
    <input type="text" id="search-box" style="background: var(--key-bg); border: none; padding: 15px; border-radius: 15px; color: var(--text); width: 100%; margin-bottom: 10px; outline: none;" placeholder="Search currency..." oninput="filterCountries(this.value)">
    <div id="country-list" style="flex: 1; overflow-y: auto;"></div>
</div>

<div class="app-container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 4px;">
            <div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span class="dot"></span>
                    <span class="sync-indicator">LIVE</span>
                </div>
                <div id="last-update" style="font-size: 10px; color: var(--secondary-text);">Syncing...</div>
            </div>
            <div class="resync-btn" onclick="updateRates()">
                <span id="resync-icon">↺</span>
            </div>
        </div>
        <div onclick="toggleTheme()" style="font-size: 24px; cursor: pointer;">☀️</div>
    </div>

    <div style="flex: 1; display: flex; flex-direction: column; justify-content: center;">
        <div style="display: flex; justify-content: space-between; align-items: baseline;">
            <input type="text" id="val-in" value="1" readonly>
            <div id="code-in" style="font-size: 20px; color: var(--secondary-text);">USD</div>
        </div>
        <div id="rate-line" style="font-size: 14px; color: var(--secondary-text); margin: 10px 0;">1 USD = ...</div>
        <div class="result-amt" id="val-out">0.00</div>
        <div id="code-out" style="font-size: 20px; color: var(--secondary-text);">SAR</div>
    </div>

    <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
        <div class="key" style="flex: 1; height: 60px; font-size: 18px; flex-direction: column;" onclick="openPicker('from')">
            <span style="font-size: 9px; opacity: 0.6;">FROM</span>
            <span id="from-btn-text">USD</span>
        </div>
        <div onclick="swap()" style="width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; font-size: 20px;">⇄</div>
        <div class="key" style="flex: 1; height: 60px; font-size: 18px; flex-direction: column;" onclick="openPicker('to')">
            <span style="font-size: 9px; opacity: 0.6;">TO</span>
            <span id="to-btn-text">SAR</span>
        </div>
    </div>

    <div class="keypad-grid">
        <div class="numeric-zone">
            <div class="key" onclick="num('7')">7</div><div class="key" onclick="num('8')">8</div><div class="key" onclick="num('9')">9</div>
            <div class="key" onclick="num('4')">4</div><div class="key" onclick="num('5')">5</div><div class="key" onclick="num('6')">6</div>
            <div class="key" onclick="num('1')">1</div><div class="key" onclick="num('2')">2</div><div class="key" onclick="num('3')">3</div>
            <div class="key" onclick="num('0')">0</div><div class="key" onclick="num('00')">00</div><div class="key" onclick="num('.')">.</div>
        </div>
        <div style="display: grid; grid-template-rows: 1fr 1fr; gap: 12px;">
            <div class="key pill-ac" onclick="num('AC')">AC</div>
            <div class="key" onclick="num('DEL')" style="color: var(--accent); font-size: 30px;">⌫</div>
        </div>
    </div>
</div>

<script>
    let ratesData = {};
    let currencyList = {};
    let fromCode = 'usd';
    let toCode = 'sar';
    let activeTarget = 'from';

    async function init() {
        const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies.json');
        currencyList = await res.json();
        delete currencyList['1inch'];
        updateRates();
    }

    async function updateRates() {
        const icon = document.getElementById('resync-icon');
        const syncLabel = document.getElementById('last-update');
        icon.classList.add('spinning');
        try {
            const res = await fetch(`https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/${fromCode}.json`);
            const data = await res.json();
            ratesData = data[fromCode];
            syncLabel.innerText = `Synced: ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            convert();
        } catch(e) { syncLabel.innerText = "Offline"; }
        setTimeout(() => icon.classList.remove('spinning'), 800);
    }

    function num(k) {
        let el = document.getElementById('val-in');
        if(k === 'AC') el.value = "0";
        else if(k === 'DEL') el.value = el.value.length > 1 ? el.value.slice(0,-1) : "0";
        else {
            if(el.value === "0" && k !== '.') el.value = k;
            else if(!(k === '.' && el.value.includes('.'))) el.value += k;
        }
        convert();
    }

    function convert() {
        const rate = ratesData[toCode];
        document.getElementById('from-btn-text').innerText = fromCode.toUpperCase();
        document.getElementById('to-btn-text').innerText = toCode.toUpperCase();
        document.getElementById('code-in').innerText = fromCode.toUpperCase();
        document.getElementById('code-out').innerText = toCode.toUpperCase();
        if(rate) {
            document.getElementById('rate-line').innerText = `1 ${fromCode.toUpperCase()} = ${rate.toFixed(4)} ${toCode.toUpperCase()}`;
            const val = parseFloat(document.getElementById('val-in').value) || 0;
            document.getElementById('val-out').innerText = (val * rate).toLocaleString(undefined, {minimumFractionDigits: 2});
        }
    }

    function openPicker(t) { activeTarget = t; document.getElementById('picker-modal').style.display = 'flex'; filterCountries(''); }
    function closePicker() { document.getElementById('picker-modal').style.display = 'none'; }

    function filterCountries(q) {
        const list = document.getElementById('country-list');
        list.innerHTML = '';
        Object.keys(currencyList).sort().forEach(code => {
            if(code.includes(q.toLowerCase()) || currencyList[code].toLowerCase().includes(q.toLowerCase())) {
                const item = document.createElement('div');
                item.className = 'country-item';
                item.innerHTML = `<strong>${currencyList[code]}</strong> (${code.toUpperCase()})`;
                item.onclick = () => { 
                    if(activeTarget === 'from') fromCode = code; else toCode = code;
                    closePicker(); updateRates(); 
                };
                list.appendChild(item);
            }
        });
    }

    function swap() { [fromCode, toCode] = [toCode, fromCode]; updateRates(); }
    function toggleTheme() { document.body.classList.toggle('light-mode'); }
    init();
</script>
</body>
</html>
